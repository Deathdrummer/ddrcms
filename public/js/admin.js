window.clearTwigCache=function(){$.post("/admin/common/clear_cache",(function(res){res?notify("Кэш успешно сброшен!"):notify("Ошибка сброса кэша!","error")}))},jQuery(document).ready((function($){var hideNavTOut;if($("nav.main_nav").on("mouseenter",(function(){clearTimeout(hideNavTOut)})),$("nav.main_nav, #openNav").on("mouseleave",(function(){hideNavTOut=setTimeout((function(){0==$("#openNav").is(":hover")&&($("i[touch]").prop("aria-expanded","false"),$(".header__item.opened").removeClass("opened"))}),300)})),$("nav.main_nav li").on(tapEvent,(function(){if(0==$(this).hasClass("active")){var thisSection=$(this).data("block");$("nav.main_nav").find("li").removeClass("active"),$(this).addClass("active"),location.hash="#"+thisSection,$(window).one("hashchange",(function(){renderSection()})),$("i[touch]").prop("aria-expanded","false"),$(".header__item.opened").removeClass("opened")}})),renderSection=function(){$("#sectionWait").addClass("visible");var params={},callback=!1,hashData=location.hash.substr(1,location.hash.length).split("."),section=hashData[0];2==arguments.length?(params=arguments[0]||{},callback="function"==typeof arguments[1]&&arguments[1]):1==arguments.length&&(params="object"==typeof arguments[0]?arguments[0]:{},callback="function"==typeof arguments[0]&&arguments[0]),$.post("/admin/get_sections_data",{section:section,params:params},(function(html){$("#section").html(html),null!=hashData[1]?($("#"+section).find(".tabstitles:not(.sub) li").removeClass("active"),$("#"+section).find(".tabstitles:not(.sub) li#"+hashData[1]).addClass("active"),$("#"+section).find(".tabstitles:not(.sub)").siblings(".tabscontent").find("[tabid]").removeClass("visible"),$("#"+section).find(".tabstitles:not(.sub)").siblings(".tabscontent").find('[tabid="'+hashData[1]+'"]').addClass("visible")):($("#"+section).find(".tabstitles:not(.sub) li:first").addClass("active"),$("#"+section).find(".tabstitles:not(.sub)").siblings(".tabscontent").find("[tabid]:first").addClass("visible")),null!=hashData[2]?$("#"+section).find(".tabstitles:not(.sub)").siblings(".tabscontent").find(".tabstitles.sub").length>0&&$("#"+section).find(".tabstitles:not(.sub)").siblings(".tabscontent").find(".tabstitles.sub").each((function(){$(this).children("li#"+hashData[2]).length>0?($(this).children("li").removeClass("active"),$(this).children("li#"+hashData[2]).addClass("active"),$(this).siblings(".tabscontent").find("[tabid]").removeClass("visible"),$(this).siblings(".tabscontent").find('[tabid="'+hashData[2]+'"]').addClass("visible")):($(this).children("li:first").addClass("active"),$(this).siblings(".tabscontent").find("[tabid]:first").addClass("visible"))})):$("#"+section).find(".tabstitles:not(.sub)").siblings(".tabscontent").find(".tabstitles.sub").length>0&&$("#"+section).find(".tabstitles:not(.sub)").siblings(".tabscontent").find(".tabstitles.sub").each((function(){$(this).children("li").removeClass("active"),$(this).children("li:first").addClass("active"),$(this).siblings(".tabscontent").find("[tabid]").removeClass("visible"),$(this).siblings(".tabscontent").find("[tabid]:first").addClass("visible")})),setBaseScripts(),1==getArgs("shownames")&&$("body").find("input, textarea, select").each((function(k,item){var thisName=$(this).attr("name")||"",mapObj={setting_:"","][":".","[":".","]":""};thisName=thisName.replace(/setting_|\]\[|\[|\]/gi,(matched=>mapObj[matched])),$(this).after("<code showinputname>"+thisName+"</code>"),$("[showinputname]").css({position:"absolute",bottom:"-18px",right:"0","font-size":"12px","background-color":"#f6ff93",padding:"1px 4px"})})),$("#sectionWait").removeClass("visible"),$(document).trigger("rendersection"),callback&&callback()}),"html").fail((function(e){notify("Системная ошибка!","error"),showError(e)}))},0==$(".auth_form").length)if(""==location.hash)location.hash="#settings",$(window).one("hashchange",(function(){renderSection()})),$('li[data-block="settings"]').addClass("active");else{var section=location.hash.substr(1,location.hash.length).split(".")[0];$('li[data-block="'+section+'"]').addClass("active"),renderSection()}function activateMarkdown(){$("body").find("[markdown]:visible:not(.activated)").each((function(k,item){$(item).addClass("activated");let simplemde=new SimpleMDE({element:item,autofocus:!1,forceSync:!0,spellChecker:!1,toolbar:["bold","italic","heading-1","heading-2","heading-3","strikethrough","|","unordered-list","ordered-list","|","link","image","table","horizontal-rule","|","quote","|","preview","side-by-side","fullscreen"]});simplemde.codemirror.on("change",(function(){$(item).text(simplemde.value())}))}))}$(document).on("rendersection",(function(){activateMarkdown(),$(document).on("tabsChange",(function(){activateMarkdown()}))})),$("#goToSite").on("click",(function(){var fullPath=location.protocol+"//"+location.host+location.pathname;window.open(fullPath.substr(0,fullPath.length-6))})),$("#adminLogout").on(tapEvent,(function(){location="admin/logout"}))}));